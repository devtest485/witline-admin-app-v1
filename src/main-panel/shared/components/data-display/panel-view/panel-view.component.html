<div class="tw-space-y-4">
    <!-- Panel Header -->
    <div class="tw-flex tw-items-center tw-justify-between tw-mb-4">
        <div>
            <h4 class="tw-text-lg tw-font-semibold theme-text-primary">
                Panel View
            </h4>
            <p class="tw-text-sm theme-text-secondary tw-mt-1">
                {{ panelData.length }} panel(s) available
            </p>
        </div>

        <div class="tw-flex tw-gap-2">
            <button nz-button nzType="default" nzSize="small" (click)="expandAll()" class="theme-transition">
                <i nz-icon nzType="arrows-alt"></i>
                Expand All
            </button>
            <button nz-button nzType="default" nzSize="small" (click)="collapseAll()" class="theme-transition">
                <i nz-icon nzType="shrink"></i>
                Collapse All
            </button>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="tw-text-center tw-py-12">
        <nz-spin nzTip="Loading panels..." nzSize="large"></nz-spin>
    </div>

    <!-- Panels -->
    <nz-collapse *ngIf="!isLoading" [nzAccordion]="accordionMode" [nzBordered]="true"
        class="theme-bg-primary tw-border theme-border-primary tw-rounded-lg theme-shadow-sm theme-transition">

        <nz-collapse-panel *ngFor="let panel of panelData; let i = index" [nzHeader]="panelHeader"
            [nzActive]="panel.expanded || i === 0" [nzDisabled]="panel.disabled" [nzExtra]="panelExtra"
            class="tw-border-b theme-border-primary last:tw-border-b-0 theme-transition">

            <!-- Panel Header Template -->
            <ng-template #panelHeader>
                <div class="tw-flex tw-items-center tw-gap-3 tw-w-full">
                    <!-- Panel Icon -->
                    <div class="tw-flex tw-items-center tw-justify-center tw-w-8 tw-h-8 tw-rounded-full
                          theme-bg-secondary theme-transition">
                        <i nz-icon [nzType]="getPanelIcon(panel)" class="tw-text-sm"
                            [class]="getPanelIconColor(panel)"></i>
                    </div>

                    <!-- Panel Title & Status -->
                    <div class="tw-flex-1">
                        <div class="tw-flex tw-items-center tw-gap-2">
                            <span class="tw-font-medium theme-text-primary">
                                {{ panel.title || panel.name || 'Panel ' + (i + 1) }}
                            </span>

                            <nz-tag *ngIf="panel.status" [nzColor]="getStatusColor(panel.status)" class="tw-text-xs">
                                {{ panel.status }}
                            </nz-tag>

                            <nz-badge *ngIf="panel.notifications" [nzCount]="panel.notifications"
                                [nzOverflowCount]="99">
                            </nz-badge>
                        </div>

                        <div *ngIf="panel.subtitle" class="tw-text-xs theme-text-secondary tw-mt-1">
                            {{ panel.subtitle }}
                        </div>
                    </div>

                    <!-- Panel Progress -->
                    <div *ngIf="panel.progress !== undefined" class="tw-text-right">
                        <div class="tw-text-xs theme-text-secondary">Progress</div>
                        <div class="tw-text-sm tw-font-medium" [class]="getProgressColor(panel.progress)">
                            {{ panel.progress }}%
                        </div>
                    </div>
                </div>
            </ng-template>

            <!-- Panel Extra Actions Template -->
            <ng-template #panelExtra>
                <div class="tw-flex tw-items-center tw-gap-1" (click)="$event.stopPropagation()">

                    <button nz-button nzType="text" nzSize="small" nz-tooltip="Edit Panel" (click)="editPanel(panel, i)"
                        class="tw-w-6 tw-h-6 tw-p-0 theme-transition hover:theme-text-primary">
                        <i nz-icon nzType="edit" class="tw-text-xs"></i>
                    </button>

                    <button nz-button nzType="text" nzSize="small" nz-tooltip="Refresh Panel"
                        (click)="refreshPanel(panel, i)"
                        class="tw-w-6 tw-h-6 tw-p-0 theme-transition hover:tw-text-blue-500">
                        <i nz-icon nzType="reload" class="tw-text-xs"></i>
                    </button>

                    <button nz-button nzType="text" nzSize="small" nz-tooltip="Remove Panel"
                        (click)="removePanel(panel, i)"
                        class="tw-w-6 tw-h-6 tw-p-0 theme-transition hover:tw-text-red-500">
                        <i nz-icon nzType="close" class="tw-text-xs"></i>
                    </button>
                </div>
            </ng-template>

            <!-- Panel Content -->
            <div class="tw-space-y-4 tw-pt-2">

                <!-- Panel Description -->
                <div *ngIf="panel.description" class="tw-text-sm theme-text-secondary tw-leading-relaxed">
                    {{ panel.description }}
                </div>

                <!-- Panel Metrics -->
                <div *ngIf="panel.metrics && panel.metrics.length"
                    class="tw-grid tw-grid-cols-2 md:tw-grid-cols-3 tw-gap-3">
                    <div *ngFor="let metric of panel.metrics"
                        class="tw-p-3 tw-rounded-lg theme-bg-tertiary tw-border theme-border-secondary theme-transition">
                        <div class="tw-text-xs theme-text-secondary tw-mb-1">
                            {{ metric.label }}
                        </div>
                        <div class="tw-text-lg tw-font-semibold theme-text-primary">
                            {{ metric.value }}
                        </div>
                        <div *ngIf="metric.change" class="tw-text-xs tw-flex tw-items-center tw-gap-1 tw-mt-1"
                            [class]="metric.change > 0 ? 'tw-text-green-500' : 'tw-text-red-500'">
                            <i nz-icon [nzType]="metric.change > 0 ? 'arrow-up' : 'arrow-down'"></i>
                            {{ Math.abs(metric.change) }}%
                        </div>
                    </div>
                </div>

                <!-- Panel Content/Data -->
                <div *ngIf="panel.content"
                    class="tw-p-4 tw-rounded-lg theme-bg-secondary tw-border theme-border-primary">
                    <div [innerHTML]="panel.content" class="tw-prose tw-max-w-none theme-text-primary"></div>
                </div>

                <!-- Panel Items List -->
                <div *ngIf="panel.items && panel.items.length" class="tw-space-y-2">
                    <div class="tw-text-sm tw-font-medium theme-text-primary tw-mb-3">
                        Items ({{ panel.items.length }})
                    </div>
                    <div *ngFor="let item of panel.items.slice(0, 5)" class="tw-flex tw-items-center tw-justify-between tw-p-2 tw-rounded 
                          theme-bg-tertiary hover:theme-bg-secondary tw-transition-colors tw-duration-200">
                        <div class="tw-flex tw-items-center tw-gap-2">
                            <i nz-icon [nzType]="item.icon || 'file'" class="tw-text-xs theme-text-secondary"></i>
                            <span class="tw-text-sm theme-text-primary">{{ item.name || item.title }}</span>
                        </div>
                        <nz-tag *ngIf="item.status" [nzColor]="getStatusColor(item.status)" class="tw-text-xs">
                            {{ item.status }}
                        </nz-tag>
                    </div>
                    <div *ngIf="panel.items.length > 5" class="tw-text-xs tw-text-center theme-text-secondary tw-py-2">
                        +{{ panel.items.length - 5 }} more items
                    </div>
                </div>

                <!-- Panel Actions -->
                <div *ngIf="panel.actions && panel.actions.length"
                    class="tw-flex tw-flex-wrap tw-gap-2 tw-pt-3 tw-border-t theme-border-secondary">
                    <button *ngFor="let action of panel.actions" nz-button [nzType]="action.type || 'default'"
                        nzSize="small" (click)="onPanelAction(action, panel, i)" class="theme-transition">
                        <i *ngIf="action.icon" nz-icon [nzType]="action.icon" class="tw-mr-1"></i>
                        {{ action.label }}
                    </button>
                </div>
            </div>
        </nz-collapse-panel>
    </nz-collapse>

    <!-- Empty State -->
    <div *ngIf="!isLoading && panelData.length === 0"
        class="tw-text-center tw-py-12 theme-bg-secondary tw-rounded-lg tw-border theme-border-primary">
        <div class="tw-mb-4">
            <i nz-icon nzType="inbox" class="tw-text-4xl theme-text-tertiary"></i>
        </div>
        <h4 class="tw-text-lg tw-font-medium theme-text-primary tw-mb-2">
            No Panels Available
        </h4>
        <p class="tw-text-sm theme-text-secondary tw-mb-4">
            Create your first panel to get started.
        </p>
        <button nz-button nzType="primary" (click)="createPanel()">
            <i nz-icon nzType="plus"></i>
            Create Panel
        </button>
    </div>
</div>